<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SMS Generator - Co-op Bank</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(149, 165, 166, 0.3);
        }

        .results {
            margin-top: 30px;
        }

        .customer-result {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }

        .customer-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .customer-info h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .sms-variation {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .sms-text {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .sms-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #666;
        }

        .char-count {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .char-count.warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .char-count.error {
            background: #ffebee;
            color: #d32f2f;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            color: #d32f2f;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ¯ AI SMS Generator</h1>
            <p>Personalized Loan Reminder Messages for Co-op Bank</p>
        </div>

        <div class="main-content">
            <!-- Single Customer Form -->
            <div class="section">
                <h2>Generate SMS for Individual Customer</h2>
                <form id="singleCustomerForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customerName">Customer Name</label>
                            <input type="text" id="customerName" name="name" placeholder="e.g., John" required>
                        </div>
                        <div class="form-group">
                            <label for="loanBalance">Loan Balance</label>
                            <input type="text" id="loanBalance" name="loan_balance" placeholder="e.g., 15,000 KES" required>
                        </div>
                        <div class="form-group">
                            <label for="dueDate">Due Date</label>
                            <input type="text" id="dueDate" name="due_date" placeholder="e.g., 20th Sept" required>
                        </div>
                        <div class="form-group">
                            <label for="tone">Tone</label>
                            <select id="tone" name="tone" required>
                                <option value="formal">Formal</option>
                                <option value="friendly">Friendly</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn">Generate SMS</button>
                </form>
            </div>

            <!-- Paraphrase SMS Template Section -->
            <div class="section">
                <h2>Paraphrase Existing SMS Template</h2>
                <form id="paraphraseForm">
                    <div class="form-group">
                        <label for="originalSms">Original SMS Template</label>
                        <textarea id="originalSms" name="original_sms" rows="3" placeholder="e.g., Dear Bett, Your loan payment is late by 203 days. Amount in arrears is KES 1,200. Please pay immediately. For inquiry call 0711049000" required></textarea>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="paraphraseCustomerName">Customer Name (for context)</label>
                            <input type="text" id="paraphraseCustomerName" name="customer_name" placeholder="e.g., Bett" required>
                        </div>
                        <div class="form-group">
                            <label for="paraphraseLoanBalance">Loan Balance (for context)</label>
                            <input type="text" id="paraphraseLoanBalance" name="loan_balance" placeholder="e.g., KES 1,200" required>
                        </div>
                        <div class="form-group">
                            <label for="paraphraseDueDate">Due Date/Status (for context)</label>
                            <input type="text" id="paraphraseDueDate" name="due_date" placeholder="e.g., late by 203 days" required>
                        </div>
                        <div class="form-group">
                            <label for="paraphraseTone">Target Tone</label>
                            <select id="paraphraseTone" name="tone" required>
                                <option value="formal">Formal</option>
                                <option value="friendly">Friendly</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn">Paraphrase SMS</button>
                </form>
            </div>

            <!-- Bulk Generation -->
            <div class="section">
                <h2>Generate SMS for All Customers</h2>
                <p style="margin-bottom: 20px; color: #666;">Generate SMS messages for all predefined customers (John, Mary, Ali) with their respective tones.</p>
                <button id="generateAllBtn" class="btn btn-secondary">Generate All SMS</button>
            </div>

            <!-- Results -->
            <div id="results" class="results"></div>
        </div>
    </div>

    <script>
        // API endpoints
        const API_BASE = '/api/sms';

        // DOM elements
        const singleCustomerForm = document.getElementById('singleCustomerForm');
        const paraphraseForm = document.getElementById('paraphraseForm');
        const generateAllBtn = document.getElementById('generateAllBtn');
        const resultsDiv = document.getElementById('results');

        // Event listeners
        singleCustomerForm.addEventListener('submit', handleSingleCustomer);
        paraphraseForm.addEventListener('submit', handleParaphraseSMS);
        generateAllBtn.addEventListener('click', handleGenerateAll);

        // Handle single customer form submission
        async function handleSingleCustomer(e) {
            e.preventDefault();
            
            const formData = new FormData(singleCustomerForm);
            const customerData = Object.fromEntries(formData);
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE}/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(customerData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displaySingleResult(data);
                } else {
                    showError(data.error || 'Failed to generate SMS');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            }
        }

        // Handle paraphrase form submission
        async function handleParaphraseSMS(e) {
            e.preventDefault();
            
            const formData = new FormData(paraphraseForm);
            const paraphraseData = Object.fromEntries(formData);
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE}/paraphrase`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(paraphraseData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayParaphraseResult(data);
                } else {
                    showError(data.error || 'Failed to paraphrase SMS');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            }
        }

        // Handle generate all button click
        async function handleGenerateAll() {
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE}/generate-all`);
                const data = await response.json();
                
                if (data.success) {
                    displayAllResults(data);
                } else {
                    showError(data.error || 'Failed to generate SMS');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            }
        }

        // Display single customer result
        function displaySingleResult(data) {
            const html = `
                <div class="section">
                    <h2>Generated SMS Messages</h2>
                    ${createCustomerResultHTML(data)}
                    ${createStatsHTML([data])}
                </div>
            `;
            resultsDiv.innerHTML = html;
        }

        // Display paraphrased result
        function displayParaphraseResult(data) {
            const html = `
                <div class="section">
                    <h2>Paraphrased SMS Messages</h2>
                    <div class="customer-result">
                        <div class="customer-info">
                            <h3>Original SMS:</h3>
                            <p>${data.original_sms}</p>
                            <p><strong>Target Tone:</strong> ${data.tone}</p>
                        </div>
                        ${data.paraphrased_variations.map((sms, index) => createSMSVariationHTML(sms, index + 1)).join('')}
                    </div>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number">1</div>
                            <div class="stat-label">Template Processed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.paraphrased_variations.length}</div>
                            <div class="stat-label">SMS Generated</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${Math.round(data.paraphrased_variations.reduce((sum, sms) => sum + sms.length, 0) / data.paraphrased_variations.length)}</div>
                            <div class="stat-label">Avg. Characters</div>
                        </div>
                    </div>
                </div>
            `;
            resultsDiv.innerHTML = html;
        }

        // Display all customers results
        function displayAllResults(data) {
            const html = `
                <div class="section">
                    <h2>Generated SMS Messages for All Customers</h2>
                    ${data.results.map(result => createCustomerResultHTML(result)).join('')}
                    ${createStatsHTML(data.results)}
                </div>
            `;
            resultsDiv.innerHTML = html;
        }

        // Create HTML for a single customer result
        function createCustomerResultHTML(result) {
            const customer = result.customer;
            const variations = result.sms_variations;
            
            return `
                <div class="customer-result">
                    <div class="customer-info">
                        <h3>${customer.name}</h3>
                        <p><strong>Loan:</strong> ${customer.loan_balance} | <strong>Due:</strong> ${customer.due_date} | <strong>Tone:</strong> ${customer.tone}</p>
                    </div>
                    ${variations.map((sms, index) => createSMSVariationHTML(sms, index + 1)).join('')}
                </div>
            `;
        }

        // Create HTML for a single SMS variation
        function createSMSVariationHTML(sms, index) {
            const charCount = sms.length;
            let charCountClass = 'char-count';
            
            if (charCount > 160) {
                charCountClass += ' error';
            } else if (charCount > 140) {
                charCountClass += ' warning';
            }
            
            return `
                <div class="sms-variation">
                    <div class="sms-text">${sms}</div>
                    <div class="sms-meta">
                        <span>Variation ${index}</span>
                        <span class="${charCountClass}">${charCount}/160 characters</span>
                    </div>
                </div>
            `;
        }

        // Create statistics HTML
        function createStatsHTML(results) {
            const totalCustomers = results.length;
            const totalSMS = results.reduce((sum, result) => sum + result.sms_variations.length, 0);
            const avgLength = Math.round(
                results.reduce((sum, result) => 
                    sum + result.sms_variations.reduce((smsSum, sms) => smsSum + sms.length, 0), 0
                ) / totalSMS
            );
            
            return `
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">${totalCustomers}</div>
                        <div class="stat-label">Customers Processed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${totalSMS}</div>
                        <div class="stat-label">SMS Generated</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${avgLength}</div>
                        <div class="stat-label">Avg. Characters</div>
                    </div>
                </div>
            `;
        }

        // Show loading state
        function showLoading() {
            resultsDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Generating personalized SMS messages...</p>
                </div>
            `;
        }

        // Show error message
        function showError(message) {
            resultsDiv.innerHTML = `
                <div class="error">
                    <strong>Error:</strong> ${message}
                </div>
            `;
        }

        // Show success message
        function showSuccess(message) {
            resultsDiv.innerHTML = `
                <div class="success">
                    <strong>Success:</strong> ${message}
                </div>
            `;
        }
    </script>
</body>
</html>

